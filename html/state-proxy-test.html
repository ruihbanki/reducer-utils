<!doctype html>
<html>
<script src="../src/state-proxy.js"></script>
<script src="../src/utils.js"></script>
<script>

const state = {
    products: [
        {
            id: 1,
            name: 'Nokia',
        },
        {
            id: 2,
            name: 'Iphone',
        },
        {
            id: 3,
            name: 'Galaxy',
        },
    ],
    tree: [
        {
            id: 1,
            name: 'Item 1',
            children: [
                {
                    id: 2,
                    name: 'Item 1.1',
                    children: [
                        {
                            id: 3,
                            name: 'Item 1.1.1',
                        }
                    ]
                },
                {
                    id: 4,
                    name: 'Item 1.2',
                }                
            ]
        },
        {
            id: 5,
            name: 'Item 2',
        },
    ],
    user: {
        name: 'Jonh',
        roles: [
            {
                id: 1,
                name: 'Engineer'
            },
            {
                id: 2,
                name: 'Manager'
            },
        ],
        roleActive: {
            id: 2,
            name: 'Manager' 
        }
    },
};

console.log('\n=> set string');
var stateProxy = createStateProxy(state);
stateProxy.user.name = 'Marie';
var newState = stateProxy.__newState;
console.log('newState', newState);
logDifferences(state, newState);

console.log('\n=> remove an item in an array by index');
var stateProxy = createStateProxy(state);
stateProxy.user.roles.splice(0, 1);
var newState = stateProxy.__newState;
console.log('newState', newState);
logDifferences(state, newState);

console.log('\n=> set in array');
var stateProxy = createStateProxy(state);
stateProxy.products[0] = {
    id: 4,
    name: 'Other',
};
var newState = stateProxy.__newState;
console.log('newState', newState);
logDifferences(state, newState);

console.log('\n=> set an proxy transform it in origina data');
var stateProxy = createStateProxy(state);
var roleProxy = stateProxy.user.roles[0];
stateProxy.user.roleActive = roleProxy;
var newState = stateProxy.__newState;
console.log('newState', newState);
logDifferences(state, newState);

console.log('\n=> helpers');
var stateProxy = createStateProxy(state);
var object = stateProxy.products[1].__object;
var isProxy = stateProxy.user.__isProxy;
var newState = stateProxy.__newState;
console.log('object', object);
console.log('isProxy', isProxy);
console.log('newState', newState);
logDifferences(state, newState);



// TODO
// support to all array methods https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/entries
// proxyState be a state and has a getNewState() method
// when set a value that is a proxy is necessary to get the original object OK
// create a method __isProxy() OK
// create a method __getRawData() OK
// 

</script>
<body>

</body>    
</html>